#pragma config(Sensor, S3,		 lightSensor,					sensorLightActive)
#pragma config(Sensor, S1,		 touchSensor,		 sensorTouch)
//*!!Code automatically generated by 'ROBOTC' configuration wizard							 !!*//
#pragma platform(NXT)

/*--------------------------------------------------------------------------------------------------------*\
|*																																																				*|
|*																					 - Line Tracker -																							*|
|*																						ROBOTC on NXT																								*|
|*																																																				*|
|*	This program allows your taskbot to follow a line in reverse.																					*|
|*																																																				*|
|*																				ROBOT CONFIGURATION																							*|
|*		NOTES:																																															*|
|*		1)	The Light Sensor is attached to the front of the robot.																					 *|
|*		2)	Be sure to take readings of your Light Sensor over the light and dark areas.	Once you have			*|
|*				the values, add them and divide by 2 to find your threshold.	Then, use your threshold as a			*|
|*				comparison in your program.																																			*|
|*																																																				*|
|*		MOTORS & SENSORS:																																										*|
|*		[I/O Port]							[Name]							[Type]							[Description]												*|
|*		Port B									motorB							NXT									Right motor													*|
|*		Port C									motorC							NXT									Left motor													*|
|*		Port 1									touchSensor					Touch Sensor				Front mounted												*|
|*		Port 3									lightSensor					Light Sensor				Front mounted												*|
\*--------------------------------------------------------------------------------------------------------*/
void checkBTLinkConnected(){
	if (nBTCurrentStreamIndex >= 0)
		return; // An existing Bluetooth connection is present.
}

task Send(){
	ubyte msg[4];
	int x = 0, y = 0;

	checkBTLinkConnected();
	setBluetoothRawDataMode();
	while (!bBTRawMode){
		// Wait for Bluecore to enter raw data mode
		wait1Msec(50);
	}
	while (true){
		msg[0] = SensorValue(lightSensor);
		msg[1] = SensorValue(touchSensor);
		x = nMotorEncoder(motorB)/20.8092485549;//resultado em cm
		y = 0;
		msg[2] = x;
		msg[3] = y;
		nxtWriteRawBluetooth(msg, 4);
		wait1Msec(2);
		//sendMessage(msg);
	}
	return;
}

task main(){
  StartTask(Send);
  //wait1Msec(50);// The program waits 50 milliseconds to initialize the light sensor.
  wait1Msec(1000);
  motor[motorB] =0;
  motor[motorC] =0;
	nMotorEncoder(motorB) = 0;
	nMotorEncoder(motorC) = 0;
	while(nMotorEncoder(motorB) < (160*360)/17.3){
	 motor[motorB] = 20;
	 motor[motorC] = 20;
	}
	motor[motorB] =0;
  motor[motorC] =0;

  // while(true){
    //preto
    // if(SensorValue[lightSensor] < 45){
      // motor[motorB] = 60;
      // motor[motorC] = 60;
      //branco
    // }else{
			// motor[motorB] = 55;
      // motor[motorC] = 60;
      // wait1Msec(300);
      // if(SensorValue[lightSensor] >= 45){//se continuar no branco
        // motor[motorB] = 60;
        // motor[motorC] = 55;
        // wait1Msec(500);
      // }
    // }
  // }
}
